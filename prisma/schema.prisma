generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String               @id @default(cuid())
  firstName          String
  lastName           String
  email              String               @unique
  password           String?
  avatar             String?
  plan               String               @default("LITE")
  status             String               @default("ACTIVE")
  hotmartCustomerId  String?
  expirationDate     DateTime?
  customPermissions  String?              @default("[]")
  passwordCreatedAt  DateTime?
  mustChangePassword Boolean              @default(true)
  loginAttempts      Int                  @default(0)
  lockedUntil        DateTime?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  lastLogin          DateTime?
  loginLogs          LoginLog[]
  resetTokens        PasswordResetToken[]
  purchases          Purchase[]
  carteirasAnalista  CarteiraAnalise[]    @relation("CarteirasAnalista")
  carteiras          CarteiraAnalise[]    @relation("CarteirasUsuario")
  instagramCadastro  InstagramCadastro?
}

model Purchase {
  id                   String   @id @default(cuid())
  userId               String
  amount               Float
  productName          String?
  status               String   @default("COMPLETED")
  hotmartTransactionId String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model LoginLog {
  id        String   @id @default(cuid())
  userId    String?
  email     String
  success   Boolean
  ip        String?
  userAgent String?
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
}

model CarteiraAnalise {
  id                      String          @id @default(cuid())
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @updatedAt
  nomeArquivo             String
  arquivoUrl              String
  valorTotal              Float?
  quantidadeAtivos        Int?
  status                  String          @default("PENDENTE")
  dataEnvio               DateTime        @default(now())
  dataAnalise             DateTime?
  userId                  String
  analistaId              String?
  feedback                String?
  recomendacoes           String?
  pontuacao               Float?
  riscoBeneficio          String?
  diversificacao          Float?
  questionario            String?
  avaliacaoAdaptacao      Int?
  avaliacaoDiversificacao Int?
  avaliacaoQualidade      Int?
  dadosEstruturados       String?
  ativos                  AtivoCarteira[]
  analista                User?           @relation("CarteirasAnalista", fields: [analistaId], references: [id])
  user                    User            @relation("CarteirasUsuario", fields: [userId], references: [id], onDelete: Cascade)

  @@map("carteiras_analise")
}

model AtivoCarteira {
  id         String          @id @default(cuid())
  createdAt  DateTime        @default(now())
  codigo     String
  quantidade Float
  precoMedio Float
  valorTotal Float
  tipo       String
  setor      String?
  carteiraId String
  carteira   CarteiraAnalise @relation(fields: [carteiraId], references: [id], onDelete: Cascade)

  @@map("ativos_carteira")
}

model InstagramCadastro {
  id                String   @id @default(cuid())
  userId            String   @unique
  instagram         String
  previousInstagram String?
  isUpdated         Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("instagram_cadastros")
}